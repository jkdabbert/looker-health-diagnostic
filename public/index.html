<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Looker Health Diagnostic Assistant</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container { 
            max-width: 900px; margin: 0 auto; background: white; padding: 40px; 
            border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        }
        .header { text-align: center; margin-bottom: 40px; }
        .header h1 { 
            color: #2d3748; margin: 0 0 10px 0; font-size: 2.5em; font-weight: 700;
        }
        .header p { 
            color: #718096; font-size: 1.1em; margin: 0;
        }
        .status { 
            padding: 20px; margin: 20px 0; border-radius: 12px; font-size: 0.95em;
        }
        .success { background: #f0fff4; color: #22543d; border-left: 4px solid #38a169; }
        .warning { background: #fffbf0; color: #744210; border-left: 4px solid #d69e2e; }
        .error { background: #fed7d7; color: #742a2a; border-left: 4px solid #e53e3e; }
        
        .buttons { text-align: center; margin: 40px 0; }
        button { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; border: none; padding: 16px 32px; border-radius: 12px; 
            cursor: pointer; font-size: 16px; font-weight: 600; margin: 10px;
            transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        button:hover { 
            transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        button:disabled { 
            background: #a0aec0; cursor: not-allowed; transform: none;
        }
        
        .results { 
            margin-top: 30px; padding: 25px; background: #f7fafc; 
            border-radius: 12px; white-space: pre-wrap; font-family: monospace; 
            font-size: 13px; line-height: 1.6; max-height: 500px; overflow-y: auto;
            display: none;
        }
        
        .loading { 
            display: none; text-align: center; margin: 30px 0;
        }
        .spinner { 
            border: 4px solid #e2e8f0; border-top: 4px solid #667eea; 
            border-radius: 50%; width: 50px; height: 50px; 
            animation: spin 1s linear infinite; margin: 0 auto 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .feature-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px; margin: 30px 0;
        }
        .feature-card {
            background: #f8fafc; padding: 20px; border-radius: 12px; 
            border: 1px solid #e2e8f0; text-align: center;
        }
        .feature-icon { font-size: 2em; margin-bottom: 10px; }
        .feature-title { font-weight: 600; color: #2d3748; margin-bottom: 8px; }
        .feature-desc { color: #718096; font-size: 0.9em; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè• Looker Health Diagnostic</h1>
            <p>AI-powered health evaluation for your Looker instance using MCP integration</p>
        </div>
        
        <div class="feature-grid">
            <div class="feature-card">
                <div class="feature-icon">üîå</div>
                <div class="feature-title">MCP Integration</div>
                <div class="feature-desc">Direct connection to Looker via Model Context Protocol</div>
            </div>
            <div class="feature-card">
                <div class="feature-icon">ü§ñ</div>
                <div class="feature-title">AI Analysis</div>
                <div class="feature-desc">Gemini-powered recommendations and insights</div>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üìä</div>
                <div class="feature-title">Health Scoring</div>
                <div class="feature-desc">Comprehensive evaluation across 5 key areas</div>
            </div>
        </div>
        
        <div id="status"></div>
        
        <div class="buttons">
            <button onclick="checkConfig()">üîß Check Configuration</button>
            <button onclick="runDiagnostic()" id="diagnosticBtn">üè• Run Health Diagnostic</button>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p><strong>üîç Running comprehensive health diagnostic...</strong></p>
            <p>Analyzing performance, governance, usage patterns, and data quality</p>
        </div>
        
        <div id="results" class="results"></div>
    </div>

    <script>
        async function checkConfig() {
            try {
                const response = await fetch('/api/config');
                const config = await response.json();
                
                const statusDiv = document.getElementById('status');
                
                let status = '<div class="status success"><strong>‚úÖ Configuration Status</strong><br><br>';
                status += `<strong>Looker URL:</strong> ${config.lookerUrl}<br>`;
                status += `<strong>Client ID:</strong> ${config.clientId}<br>`;
                status += `<strong>Mock Data:</strong> ${config.mockData ? 'üé≠ Enabled (Demo Mode)' : 'üîó Disabled (Real Data)'}<br>`;
                status += `<strong>MCP Integration:</strong> ${config.mcpEnabled ? '‚úÖ Ready' : '‚ùå Not Available'}`;
                status += '</div>';
                
                if (config.mockData) {
                    status += '<div class="status warning"><strong>üé≠ Demo Mode Active</strong><br>';
                    status += 'Using simulated Looker data for demonstration purposes.<br>';
                    status += 'Perfect for hackathon demos! Set <code>USE_MOCK_DATA=false</code> for real data.</div>';
                }
                
                statusDiv.innerHTML = status;
            } catch (error) {
                document.getElementById('status').innerHTML = 
                    `<div class="status error"><strong>‚ùå Configuration Error</strong><br>${error.message}</div>`;
            }
        }
        
        async function runDiagnostic() {
            const btn = document.getElementById('diagnosticBtn');
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            
            btn.disabled = true;
            btn.textContent = 'üîÑ Running...';
            loading.style.display = 'block';
            results.style.display = 'none';
            results.innerHTML = '';
            
            try {
                const response = await fetch('/api/diagnostic/run', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    const healthGrade = data.overallGrade;
                    const gradeColor = healthGrade === 'A' ? '#22543d' : 
                                     healthGrade === 'B' ? '#2d3748' :
                                     healthGrade === 'C' ? '#744210' : '#742a2a';
                                     
                    results.innerHTML = `üèÜ LOOKER HEALTH DIAGNOSTIC REPORT
${'='.repeat(50)}

üìä OVERALL HEALTH GRADE: ${healthGrade}
üïê Scan Completed: ${new Date(data.timestamp).toLocaleString()}
üîç Total Issues Found: ${data.totalIssuesFound}

üìà HEALTH METRICS BREAKDOWN:
${'‚îÄ'.repeat(30)}
‚ö° Performance:     ${data.healthMetrics.performance}/100 ${getHealthEmoji(data.healthMetrics.performance)}
üìã Governance:      ${data.healthMetrics.governance}/100 ${getHealthEmoji(data.healthMetrics.governance)}
üë• Usage:           ${data.healthMetrics.usage}/100 ${getHealthEmoji(data.healthMetrics.usage)}
üîç Data Quality:    ${data.healthMetrics.dataQuality}/100 ${getHealthEmoji(data.healthMetrics.dataQuality)}
üõ°Ô∏è  Security:       ${data.healthMetrics.security}/100 ${getHealthEmoji(data.healthMetrics.security)}

üö® CRITICAL ISSUES (Top 5):
${'‚îÄ'.repeat(30)}
${data.detailedIssues.slice(0, 5).map((issue, i) => 
`${i+1}. [${issue.severity.toUpperCase()}] ${issue.dashboard}
   Issue: ${issue.issue}
   üí° Fix: ${issue.recommendation}
`).join('\n')}

ü§ñ AI-POWERED RECOMMENDATIONS:
${'‚îÄ'.repeat(30)}
${data.aiRecommendations.priorities.map((p, i) => 
`üéØ PRIORITY ${p.priority}: ${p.title}
   üìä Impact: ${p.estimatedImpact} | ‚è±Ô∏è  Timeline: ${p.timeframe}
   üìù ${p.description}
`).join('\n')}

üöÄ STRATEGIC INITIATIVES:
${'‚îÄ'.repeat(30)}
${data.aiRecommendations.strategicRecommendations.map((r, i) => 
`${i+1}. [${r.category}] ${r.recommendation}
   ü§î Why: ${r.rationale}
   üìà Expected: ${r.expectedOutcome}
`).join('\n')}

üìÖ Next Review: ${new Date(data.aiRecommendations.nextReviewDate).toDateString()}

üèÜ Built with ‚ù§Ô∏è  for Looker Hackathon 2025 | Powered by MCP + Gemini AI`;

                    results.style.display = 'block';
                } else {
                    results.innerHTML = `‚ùå DIAGNOSTIC FAILED\n\nError: ${data.error}`;
                    results.style.display = 'block';
                }
            } catch (error) {
                results.innerHTML = `‚ùå NETWORK ERROR\n\nDetails: ${error.message}`;
                results.style.display = 'block';
            } finally {
                btn.disabled = false;
                btn.textContent = 'üè• Run Health Diagnostic';
                loading.style.display = 'none';
            }
        }
        
        function getHealthEmoji(score) {
            if (score >= 90) return 'üü¢';
            if (score >= 80) return 'üü°';
            if (score >= 60) return 'üü†';
            return 'üî¥';
        }
        
        // Auto-check configuration when page loads
        window.onload = checkConfig;
    </script>
</body>
</html>