<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Looker Health Diagnostic Assistant</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { createRoot } = ReactDOM;

        // Simple icon components
        const Activity = ({ className }) => <div className={`${className} flex items-center justify-center`}>📊</div>;
        const AlertTriangle = ({ className }) => <div className={`${className} flex items-center justify-center`}>⚠️</div>;
        const CheckCircle = ({ className }) => <div className={`${className} flex items-center justify-center`}>✅</div>;
        const Clock = ({ className }) => <div className={`${className} flex items-center justify-center`}>⏰</div>;
        const Database = ({ className }) => <div className={`${className} flex items-center justify-center`}>🗄️</div>;
        const TrendingUp = ({ className }) => <div className={`${className} flex items-center justify-center`}>📈</div>;
        const Users = ({ className }) => <div className={`${className} flex items-center justify-center`}>👥</div>;
        const Zap = ({ className }) => <div className={`${className} flex items-center justify-center`}>⚡</div>;
        const Target = ({ className }) => <div className={`${className} flex items-center justify-center`}>🎯</div>;
        const BookOpen = ({ className }) => <div className={`${className} flex items-center justify-center`}>📖</div>;
        const Shield = ({ className }) => <div className={`${className} flex items-center justify-center`}>🛡️</div>;
        const Code = ({ className }) => <div className={`${className} flex items-center justify-center`}>💻</div>;
        const Settings = ({ className }) => <div className={`${className} flex items-center justify-center`}>🔧</div>;

        // API Testing Tab Component
        const APITestingTab = () => {
          const [testType, setTestType] = useState('mcp');
          const [toolName, setToolName] = useState('');
          const [apiEndpoint, setApiEndpoint] = useState('');
          const [httpMethod, setHttpMethod] = useState('GET');
          const [testArguments, setTestArguments] = useState('{}');
          const [isLoading, setIsLoading] = useState(false);
          const [response, setResponse] = useState(null);
          const [selectedTab, setSelectedTab] = useState('response');

          // Predefined tests based on your MCP server capabilities
          const predefinedTests = {
            get_models: {
              testType: 'mcp',
              toolName: 'all_lookml_models',
              arguments: '{}'
            },
            get_specific_model: {
              testType: 'mcp',
              toolName: 'looker_model',
              arguments: '{"lookml_model_name": "looker-malloy-sources"}'
            },
            slow_queries: {
              testType: 'mcp',
              toolName: 'query',
              arguments: JSON.stringify({
                model: "system__activity",
                explore: "history",
                fields: [
                  "query.id",
                  "query.slug", 
                  "history.runtime",
                  "history.created_date",
                  "query.model",
                  "query.explore"
                ],
                filters: {
                  "history.runtime": ">5",
                  "history.created_date": "7 days ago for 7 days",
                  "history.status": "complete"
                },
                sorts: ["history.runtime desc"],
                limit: 10
              }, null, 2)
            },
            projects: {
              testType: 'api',
              apiEndpoint: '/api/4.0/projects',
              httpMethod: 'GET',
              arguments: '{}'
            },
            test_connection: {
              testType: 'mcp',
              toolName: 'list_tools',
              arguments: '{}'
            }
          };

          const loadPredefinedTest = (testKey) => {
            const test = predefinedTests[testKey];
            if (test) {
              setTestType(test.testType);
              setToolName(test.toolName || '');
              setApiEndpoint(test.apiEndpoint || '');
              setHttpMethod(test.httpMethod || 'GET');
              setTestArguments(test.arguments);
            }
          };

          const executeTest = async () => {
            setIsLoading(true);
            setResponse(null);

            const startTime = Date.now();

            try {
              let result;
              
              if (testType === 'mcp') {
                result = await fetch('/api/test-mcp', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                    toolName: toolName,
                    arguments: JSON.parse(testArguments || '{}')
                  })
                });
              } else {
                result = await fetch('/api/test-api', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                    endpoint: apiEndpoint,
                    method: httpMethod,
                    body: httpMethod !== 'GET' ? JSON.parse(testArguments || '{}') : null
                  })
                });
              }

              const endTime = Date.now();
              const responseData = await result.json();

              setResponse({
                success: result.ok,
                status: result.status,
                data: responseData,
                timing: {
                  duration: endTime - startTime,
                  status: result.status
                },
                request: {
                  type: testType,
                  toolName: toolName,
                  endpoint: apiEndpoint,
                  method: httpMethod,
                  arguments: testArguments
                }
              });
            } catch (error) {
              const endTime = Date.now();
              setResponse({
                success: false,
                status: 'Error',
                data: { error: error.message },
                timing: {
                  duration: endTime - startTime,
                  status: 'Failed'
                },
                request: {
                  type: testType,
                  toolName: toolName,
                  endpoint: apiEndpoint,
                  method: httpMethod,
                  arguments: testArguments
                }
              });
            } finally {
              setIsLoading(false);
            }
          };

          return (
            <div className="space-y-6">
              {/* Header */}
              <div className="bg-white rounded-lg shadow p-6">
                <div className="flex items-center space-x-3 mb-4">
                  <Code className="w-6 h-6 text-blue-600" />
                  <div>
                    <h2 className="text-xl font-bold text-gray-800">API Testing Dashboard</h2>
                    <p className="text-sm text-gray-600">Test and debug your Looker API calls and MCP tools</p>
                  </div>
                </div>

                {/* Quick Test Buttons */}
                <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-3 mb-6">
                  <button
                    onClick={() => loadPredefinedTest('get_models')}
                    className="p-3 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg text-sm text-blue-800 transition-colors"
                  >
                    📋 Get All Models
                  </button>
                  <button
                    onClick={() => loadPredefinedTest('get_specific_model')}
                    className="p-3 bg-green-50 hover:bg-green-100 border border-green-200 rounded-lg text-sm text-green-800 transition-colors"
                  >
                    🎯 Get Specific Model
                  </button>
                  <button
                    onClick={() => loadPredefinedTest('slow_queries')}
                    className="p-3 bg-red-50 hover:bg-red-100 border border-red-200 rounded-lg text-sm text-red-800 transition-colors"
                  >
                    🐌 Slow Queries
                  </button>
                  <button
                    onClick={() => loadPredefinedTest('projects')}
                    className="p-3 bg-purple-50 hover:bg-purple-100 border border-purple-200 rounded-lg text-sm text-purple-800 transition-colors"
                  >
                    📁 Get Projects
                  </button>
                  <button
                    onClick={() => loadPredefinedTest('test_connection')}
                    className="p-3 bg-orange-50 hover:bg-orange-100 border border-orange-200 rounded-lg text-sm text-orange-800 transition-colors"
                  >
                    🔧 Test Connection
                  </button>
                </div>

                {/* Test Form */}
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Test Type</label>
                    <select
                      value={testType}
                      onChange={(e) => setTestType(e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                      <option value="mcp">MCP Tool Call</option>
                      <option value="api">Direct API Call</option>
                    </select>
                  </div>

                  {testType === 'mcp' ? (
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Tool Name</label>
                      <input
                        type="text"
                        value={toolName}
                        onChange={(e) => setToolName(e.target.value)}
                        placeholder="e.g., looker_model, query, all_lookml_models"
                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      />
                    </div>
                  ) : (
                    <>
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">API Endpoint</label>
                        <input
                          type="text"
                          value={apiEndpoint}
                          onChange={(e) => setApiEndpoint(e.target.value)}
                          placeholder="e.g., /api/4.0/lookml_models"
                          className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">HTTP Method</label>
                        <select
                          value={httpMethod}
                          onChange={(e) => setHttpMethod(e.target.value)}
                          className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        >
                          <option value="GET">GET</option>
                          <option value="POST">POST</option>
                          <option value="PUT">PUT</option>
                          <option value="DELETE">DELETE</option>
                        </select>
                      </div>
                    </>
                  )}
                </div>

                <div className="mb-4">
                  <label className="block text-sm font-medium text-gray-700 mb-2">Arguments/Body (JSON)</label>
                  <textarea
                    value={testArguments}
                    onChange={(e) => setTestArguments(e.target.value)}
                    placeholder='{"lookml_model_name": "looker-malloy-sources"}'
                    rows={6}
                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm"
                  />
                </div>

                <button
                  onClick={executeTest}
                  disabled={isLoading}
                  className="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-4 py-3 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2"
                >
                  {isLoading ? (
                    <>
                      <div className="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full" />
                      <span>Executing...</span>
                    </>
                  ) : (
                    <>
                      <Zap className="w-4 h-4" />
                      <span>Execute Test</span>
                    </>
                  )}
                </button>
              </div>

              {/* Response Section */}
              {response && (
                <div className="bg-white rounded-lg shadow">
                  <div className="px-6 py-4 border-b border-gray-200">
                    <div className="flex items-center justify-between">
                      <h3 className="text-lg font-semibold text-gray-800">Test Results</h3>
                      <div className="flex items-center space-x-2">
                        <span
                          className={`px-3 py-1 rounded-full text-sm font-medium ${
                            response.success 
                              ? 'bg-green-100 text-green-800' 
                              : 'bg-red-100 text-red-800'
                          }`}
                        >
                          {response.success ? '✅ Success' : '❌ Error'} - {response.status}
                        </span>
                        <span className="text-sm text-gray-500">
                          {response.timing.duration}ms
                        </span>
                      </div>
                    </div>
                  </div>

                  {/* Response Tabs */}
                  <div className="border-b border-gray-200">
                    <nav className="flex space-x-8 px-6">
                      {['response', 'request', 'timing'].map((tab) => (
                        <button
                          key={tab}
                          onClick={() => setSelectedTab(tab)}
                          className={`py-4 border-b-2 font-medium text-sm ${
                            selectedTab === tab
                              ? 'border-blue-500 text-blue-600'
                              : 'border-transparent text-gray-500 hover:text-gray-700'
                          }`}
                        >
                          {tab.charAt(0).toUpperCase() + tab.slice(1)}
                        </button>
                      ))}
                    </nav>
                  </div>

                  {/* Tab Content */}
                  <div className="p-6">
                    {selectedTab === 'response' && (
                      <div className="bg-gray-50 rounded-lg p-4 max-h-96 overflow-y-auto">
                        <pre className="text-sm text-gray-800 whitespace-pre-wrap">
                          {JSON.stringify(response.data, null, 2)}
                        </pre>
                      </div>
                    )}

                    {selectedTab === 'request' && (
                      <div className="bg-gray-50 rounded-lg p-4">
                        <pre className="text-sm text-gray-800 whitespace-pre-wrap">
{`Request Type: ${response.request.type.toUpperCase()}
${response.request.type === 'mcp' ? 'Tool Name: ' + response.request.toolName : 'Endpoint: ' + response.request.endpoint}
${response.request.type === 'api' ? 'Method: ' + response.request.method : ''}
Arguments/Body:
${response.request.arguments}`}
                        </pre>
                      </div>
                    )}

                    {selectedTab === 'timing' && (
                      <div className="bg-gray-50 rounded-lg p-4">
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                          <div className="text-center">
                            <div className="text-2xl font-bold text-blue-600">{response.timing.duration}ms</div>
                            <div className="text-sm text-gray-600">Total Duration</div>
                          </div>
                          <div className="text-center">
                            <div className="text-2xl font-bold text-green-600">
                              {response.timing.duration < 1000 ? 'Fast' : 
                               response.timing.duration < 3000 ? 'Normal' : 'Slow'}
                            </div>
                            <div className="text-sm text-gray-600">Performance</div>
                          </div>
                          <div className="text-center">
                            <div className="text-2xl font-bold text-purple-600">{response.status}</div>
                            <div className="text-sm text-gray-600">Status</div>
                          </div>
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              )}
            </div>
          );
        };

        const LookerHealthDashboard = () => {
          const [diagnosticResults, setDiagnosticResults] = useState(null);
          const [isRunning, setIsRunning] = useState(false);
          const [selectedTab, setSelectedTab] = useState('overview');
          const [error, setError] = useState(null);

          const runDiagnostic = async () => {
            setIsRunning(true);
            setError(null);
            
            try {
              const response = await fetch('/api/diagnostic/run', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
              });
              
              if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
              }
              
              const data = await response.json();
              
              if (!data || typeof data !== 'object') {
                throw new Error('Invalid response structure from API');
              }
              
              setDiagnosticResults(data);
              
            } catch (error) {
              console.error('Diagnostic failed:', error);
              setError(error.message);
            } finally {
              setIsRunning(false);
            }
          };

          const getSeverityColor = (severity) => {
            switch (severity) {
              case 'critical': return 'bg-red-100 text-red-800';
              case 'high': return 'bg-red-100 text-red-800';
              case 'medium': return 'bg-yellow-100 text-yellow-800';
              case 'low': return 'bg-blue-100 text-blue-800';
              default: return 'bg-gray-100 text-gray-800';
            }
          };

          const HealthMetricCard = ({ title, score = 0, icon: Icon, description }) => (
            <div className={`p-6 rounded-lg border-2 ${score >= 80 ? 'bg-green-100' : score >= 60 ? 'bg-yellow-100' : 'bg-red-100'} border-gray-200`}>
              <div className="flex items-center justify-between mb-2">
                <div className="flex items-center space-x-2">
                  <Icon className={`w-5 h-5 ${score >= 80 ? 'text-green-600' : score >= 60 ? 'text-yellow-600' : 'text-red-600'}`} />
                  <h3 className="font-semibold text-gray-700">{title}</h3>
                </div>
                <span className={`text-2xl font-bold ${score >= 80 ? 'text-green-600' : score >= 60 ? 'text-yellow-600' : 'text-red-600'}`}>
                  {score}/100
                </span>
              </div>
              <div className="w-full bg-gray-200 rounded-full h-2">
                <div 
                  className={`h-2 rounded-full ${score >= 80 ? 'bg-green-500' : score >= 60 ? 'bg-yellow-500' : 'bg-red-500'}`}
                  style={{ width: `${score}%` }}
                />
              </div>
              <p className="text-sm text-gray-600 mt-2">{description}</p>
            </div>
          );

          const SQLAnalysisCard = ({ analysis }) => {
            const [showOriginalSQL, setShowOriginalSQL] = useState(false);
            
            return (
              <div className="bg-white rounded-lg shadow p-6 mb-4 border-l-4 border-purple-500">
                <div className="flex items-center justify-between mb-4">
                  <h4 className="text-lg font-semibold text-gray-800 flex items-center space-x-2">
                    <Code className="w-5 h-5 text-purple-600" />
                    <span>Query {analysis.queryId} - Analysis</span>
                  </h4>
                  <div className="flex items-center space-x-2">
                    <span className="bg-red-100 text-red-800 text-sm px-3 py-1 rounded-full">
                      {analysis.runtime}s runtime
                    </span>
                    {analysis.overallPriority && (
                      <span className={`text-sm px-3 py-1 rounded-full ${getSeverityColor(analysis.overallPriority)}`}>
                        {analysis.overallPriority} priority
                      </span>
                    )}
                  </div>
                </div>

                <div className="mb-6">
                  <button
                    onClick={() => setShowOriginalSQL(!showOriginalSQL)}
                    className="flex items-center space-x-2 text-sm font-medium text-blue-600 hover:text-blue-800 transition-colors"
                  >
                    <Database className="w-4 h-4" />
                    <span>{showOriginalSQL ? 'Hide' : 'View'} Original SQL Query</span>
                    <span 
                      className="transform transition-transform duration-200"
                      style={{ transform: showOriginalSQL ? 'rotate(180deg)' : 'rotate(0deg)' }}
                    >
                      ▼
                    </span>
                  </button>
                  
                  {showOriginalSQL && (
                    <div className="mt-3 border rounded-lg overflow-hidden">
                      <div className="bg-gray-800 text-white px-3 py-2 text-sm font-medium">
                        Original SQL Query ({analysis.model || 'Unknown'}.{analysis.explore || 'Unknown'})
                      </div>
                      <div className="bg-gray-50 p-4 max-h-64 overflow-y-auto">
                        <pre className="text-sm text-gray-800 whitespace-pre-wrap">
                          {analysis.sql || analysis.originalSQL || 'SQL query not available'}
                        </pre>
                      </div>
                      {(analysis.dashboard || analysis.user) && (
                        <div className="bg-blue-50 px-3 py-2 text-xs text-blue-700 border-t">
                          {analysis.dashboard && `Dashboard: ${analysis.dashboard}`}
                          {analysis.dashboard && analysis.user && ' | '}
                          {analysis.user && `User: ${analysis.user}`}
                        </div>
                      )}
                    </div>
                  )}
                </div>

                {analysis.issues && analysis.issues.length > 0 && (
                  <div className="mb-4">
                    <h5 className="font-medium text-gray-700 mb-2">Issues Identified:</h5>
                    <ul className="space-y-2">
                      {analysis.issues.map((issue, i) => (
                        <li key={i} className={`p-2 rounded ${getSeverityColor(issue.severity)}`}>
                          <strong>{issue.type.replace(/_/g, ' ').toUpperCase()}:</strong> {issue.description}
                        </li>
                      ))}
                    </ul>
                  </div>
                )}
                
                {analysis.recommendations && analysis.recommendations.length > 0 && (
                  <div className="mb-4">
                    <h5 className="font-medium text-gray-700 mb-2">Recommendations:</h5>
                    <ul className="space-y-2">
                      {analysis.recommendations.map((rec, i) => (
                        <li key={i} className="p-2 bg-green-50 rounded border-l-4 border-green-400">
                          <strong>{rec.type.replace(/_/g, ' ').toUpperCase()}:</strong> {rec.action}
                          <div className="text-sm text-green-700 mt-1">
                            Expected: {rec.expectedImprovement} | Effort: {rec.effort}
                          </div>
                        </li>
                      ))}
                    </ul>
                  </div>
                )}
              </div>
            );
          };

          // Tab content components
          const renderTabContent = () => {
            switch (selectedTab) {
              case 'overview':
                if (!diagnosticResults) return null;
                return (
                  <div className="space-y-8">
                    {/* Health Metrics */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
                      <HealthMetricCard
                        title="Performance"
                        score={diagnosticResults.healthMetrics?.performance || 0}
                        icon={Activity}
                        description="Query and system performance"
                      />
                      <HealthMetricCard
                        title="Governance"
                        score={diagnosticResults.healthMetrics?.governance || 0}
                        icon={Shield}
                        description="Data governance and security"
                      />
                      <HealthMetricCard
                        title="Usage"
                        score={diagnosticResults.healthMetrics?.usage || 0}
                        icon={Users}
                        description="User adoption and engagement"
                      />
                      <HealthMetricCard
                        title="Data Quality"
                        score={diagnosticResults.healthMetrics?.dataQuality || 0}
                        icon={Database}
                        description="Data accuracy and consistency"
                      />
                      <HealthMetricCard
                        title="Security"
                        score={diagnosticResults.healthMetrics?.security || 0}
                        icon={Shield}
                        description="Access controls and compliance"
                      />
                    </div>

                    {/* Summary Stats */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                      <div className="bg-white p-6 rounded-lg shadow">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="text-sm font-medium text-gray-600">Slow Queries Found</p>
                            <p className="text-3xl font-bold text-red-600">
                              {diagnosticResults.slowQueryAnalysis?.totalSlowQueries || 0}
                            </p>
                          </div>
                          <div className="text-4xl">🐌</div>
                        </div>
                        <div className="text-xs text-gray-500 mt-2">Queries taking >5 seconds</div>
                      </div>
                      
                      <div className="bg-white p-6 rounded-lg shadow">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="text-sm font-medium text-gray-600">AI SQL Analysis</p>
                            <p className="text-3xl font-bold text-purple-600">
                              {diagnosticResults.slowQueryAnalysis?.sqlQueriesAnalyzed || 0}
                            </p>
                          </div>
                          <div className="text-4xl">🤖</div>
                        </div>
                        <div className="text-xs text-gray-500 mt-2">With detailed optimizations</div>
                      </div>

                      <div className="bg-white p-6 rounded-lg shadow">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="text-sm font-medium text-gray-600">Potential Speedup</p>
                            <p className="text-3xl font-bold text-green-600">
                              {diagnosticResults.slowQueryAnalysis?.potentialImprovement || 'N/A'}
                            </p>
                          </div>
                          <div className="text-4xl">⚡</div>
                        </div>
                        <div className="text-xs text-gray-500 mt-2">Average improvement estimate</div>
                      </div>

                      <div className="bg-white p-6 rounded-lg shadow">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="text-sm font-medium text-gray-600">Total Issues</p>
                            <p className="text-3xl font-bold text-orange-600">
                              {diagnosticResults.totalIssuesFound || 0}
                            </p>
                          </div>
                          <div className="text-4xl">⚠️</div>
                        </div>
                        <div className="text-xs text-gray-500 mt-2">Across all categories</div>
                      </div>
                    </div>

                    {/* Enhanced Features Status */}
                    {diagnosticResults.enhancedFeatures && (
                      <div className="bg-white rounded-lg shadow">
                        <div className="px-6 py-4 border-b border-gray-200">
                          <h3 className="text-lg font-semibold text-gray-800">Enhanced Analysis Features</h3>
                          <p className="text-sm text-gray-600">Advanced diagnostic capabilities</p>
                        </div>
                        <div className="p-6">
                          <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
                            <div className="text-center">
                              <div className={`text-3xl mb-2 ${diagnosticResults.enhancedFeatures.sqlAnalysis ? 'text-green-500' : 'text-red-500'}`}>
                                {diagnosticResults.enhancedFeatures.sqlAnalysis ? '✅' : '❌'}
                              </div>
                              <div className="text-sm font-medium">SQL Analysis</div>
                              <div className="text-xs text-gray-500">Before/After Code</div>
                            </div>
                            <div className="text-center">
                              <div className={`text-3xl mb-2 ${diagnosticResults.enhancedFeatures.specificRecommendations ? 'text-green-500' : 'text-red-500'}`}>
                                {diagnosticResults.enhancedFeatures.specificRecommendations ? '✅' : '❌'}
                              </div>
                              <div className="text-sm font-medium">Specific Recommendations</div>
                              <div className="text-xs text-gray-500">Actionable optimizations</div>
                            </div>
                            <div className="text-center">
                              <div className={`text-3xl mb-2 ${diagnosticResults.enhancedFeatures.lookmlOptimizations ? 'text-green-500' : 'text-red-500'}`}>
                                {diagnosticResults.enhancedFeatures.lookmlOptimizations ? '✅' : '❌'}
                              </div>
                              <div className="text-sm font-medium">LookML Optimization</div>
                              <div className="text-xs text-gray-500">Aggregate tables & PDTs</div>
                            </div>
                            <div className="text-center">
                              <div className="text-3xl mb-2 text-green-500">✅</div>
                              <div className="text-sm font-medium">MCP Integration</div>
                              <div className="text-xs text-gray-500">Real-time data access</div>
                            </div>
                          </div>
                        </div>
                      </div>
                    )}
                  </div>
                );

              case 'query-analysis':
                if (!diagnosticResults) return <div className="text-center py-8 text-gray-500">No analysis data available</div>;
                return (
                  <div className="space-y-6">
                    {diagnosticResults.queryAnalysis && diagnosticResults.queryAnalysis.length > 0 ? (
                      <div className="bg-white rounded-lg shadow">
                        <div className="px-6 py-4 border-b border-gray-200">
                          <h3 className="text-lg font-semibold text-gray-800">SQL Query Analysis</h3>
                          <p className="text-sm text-gray-600">Detailed analysis of slow queries</p>
                        </div>
                        <div className="p-6">
                          {diagnosticResults.queryAnalysis.map((analysis, index) => (
                            <SQLAnalysisCard key={index} analysis={analysis} />
                          ))}
                        </div>
                      </div>
                    ) : (
                      <div className="text-center py-8 text-gray-500">
                        No query analysis available. Run a diagnostic to analyze queries.
                      </div>
                    )}
                  </div>
                );

              case 'issues':
                if (!diagnosticResults || !diagnosticResults.detailedIssues) {
                  return <div className="text-center py-8 text-gray-500">No issues data available</div>;
                }
                return (
                  <div className="bg-white rounded-lg shadow">
                    <div className="px-6 py-4 border-b border-gray-200">
                      <h3 className="text-lg font-semibold text-gray-800">All Issues ({diagnosticResults.totalIssuesFound || 0})</h3>
                    </div>
                    <div className="divide-y divide-gray-200">
                      {diagnosticResults.detailedIssues.length > 0 ? diagnosticResults.detailedIssues.map((issue, index) => (
                        <div key={index} className="p-6">
                          <div className="flex items-start justify-between">
                            <div className="flex-1">
                              <div className="flex items-center space-x-3 mb-2">
                                <span className={`px-2 py-1 text-xs font-medium rounded-full ${getSeverityColor(issue.severity)}`}>
                                  {(issue.severity || 'unknown').toUpperCase()}
                                </span>
                                <span className="text-xs text-gray-500 uppercase tracking-wide">{issue.type || 'general'}</span>
                              </div>
                              <h4 className="font-medium text-gray-900 mb-1">{issue.dashboard || issue.item || 'Unknown'}</h4>
                              <p className="text-sm text-gray-600 mb-2">{issue.issue || 'No description available'}</p>
                              <div className="bg-blue-50 p-3 rounded-md">
                                <p className="text-sm text-blue-800">
                                  <strong>Recommendation:</strong> {issue.recommendation || 'No recommendation available'}
                                </p>
                              </div>
                            </div>
                          </div>
                        </div>
                      )) : (
                        <div className="p-6 text-center text-gray-500">No issues found</div>
                      )}
                    </div>
                  </div>
                );

              case 'recommendations':
                if (!diagnosticResults || !diagnosticResults.aiRecommendations) {
                  return <div className="text-center py-8 text-gray-500">No recommendations available</div>;
                }
                return (
                  <div className="space-y-8">
                    <div className="bg-white rounded-lg shadow">
                      <div className="px-6 py-4 border-b border-gray-200">
                        <h3 className="text-lg font-semibold text-gray-800">Priority Actions</h3>
                      </div>
                      <div className="p-6 space-y-6">
                        {diagnosticResults.aiRecommendations.priorities && diagnosticResults.aiRecommendations.priorities.length > 0 ? 
                          diagnosticResults.aiRecommendations.priorities.map((priority, index) => (
                            <div key={index} className="border-l-4 border-purple-500 pl-6">
                              <div className="flex items-center space-x-2 mb-2">
                                <span className="bg-purple-100 text-purple-800 text-xs font-medium px-2 py-1 rounded-full">
                                  Priority #{priority.priority}
                                </span>
                              </div>
                              <h4 className="text-lg font-semibold text-gray-800 mb-2">{priority.title}</h4>
                              <p className="text-gray-600 mb-3">{priority.description}</p>
                              <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                <div className="bg-green-50 p-3 rounded">
                                  <span className="font-medium text-green-800">Impact:</span>
                                  <span className="ml-1 text-green-700">{priority.estimatedImpact || 'Unknown'}</span>
                                </div>
                                <div className="bg-blue-50 p-3 rounded">
                                  <span className="font-medium text-blue-800">Effort:</span>
                                  <span className="ml-1 text-blue-700">{priority.estimatedEffort || 'Unknown'}</span>
                                </div>
                                <div className="bg-orange-50 p-3 rounded">
                                  <span className="font-medium text-orange-800">Timeline:</span>
                                  <span className="ml-1 text-orange-700">{priority.timeframe || 'Unknown'}</span>
                                </div>
                              </div>
                            </div>
                          )) : (
                            <div className="text-center text-gray-500 py-8">
                              No recommendations available. Run a diagnostic to generate recommendations.
                            </div>
                          )
                        }
                      </div>
                    </div>
                  </div>
                );

              case 'api-testing':
                return <APITestingTab />;

              default:
                return <div className="text-center py-8 text-gray-500">Tab content coming soon...</div>;
            }
          };

          if (error && !diagnosticResults) {
            return (
              <div className="min-h-screen bg-gray-50 flex items-center justify-center">
                <div className="text-center max-w-md">
                  <AlertTriangle className="w-20 h-20 text-red-500 mx-auto mb-6" />
                  <h1 className="text-2xl font-bold text-gray-800 mb-4">Diagnostic Failed</h1>
                  <p className="text-gray-600 mb-6">{error}</p>
                  <button
                    onClick={runDiagnostic}
                    className="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-semibold"
                  >
                    Try Again
                  </button>
                </div>
              </div>
            );
          }

          if (isRunning) {
            return (
              <div className="min-h-screen bg-gray-50 flex items-center justify-center">
                <div className="text-center">
                  <div className="animate-pulse">
                    <Activity className="w-16 h-16 text-blue-500 mx-auto mb-4" />
                  </div>
                  <h2 className="text-2xl font-bold text-gray-800 mb-2">Running Diagnostic</h2>
                  <p className="text-gray-600">Analyzing your Looker instance...</p>
                </div>
              </div>
            );
          }

          if (!diagnosticResults) {
            return (
              <div className="min-h-screen bg-gray-50 flex items-center justify-center">
                <div className="text-center max-w-md">
                  <Activity className="w-20 h-20 text-blue-500 mx-auto mb-6" />
                  <h1 className="text-3xl font-bold text-gray-800 mb-4">Looker Health Diagnostic</h1>
                  <p className="text-gray-600 mb-6">Comprehensive analysis with API testing capabilities</p>
                  <button
                    onClick={runDiagnostic}
                    className="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-semibold"
                  >
                    Run Diagnostic
                  </button>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-gray-50">
              {/* Header */}
              <div className="bg-white shadow-sm border-b">
                <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                  <div className="flex items-center justify-between">
                    <div className="flex items-center space-x-3">
                      <Activity className="w-8 h-8 text-blue-600" />
                      <div>
                        <h1 className="text-2xl font-bold text-gray-800">Looker Health Diagnostic</h1>
                        <p className="text-sm text-gray-600">
                          Last scan: {diagnosticResults.timestamp ? new Date(diagnosticResults.timestamp).toLocaleString() : 'Unknown'}
                        </p>
                      </div>
                    </div>
                    <button
                      onClick={runDiagnostic}
                      className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg"
                    >
                      Re-run Analysis
                    </button>
                  </div>
                </div>
              </div>

              {/* Navigation Tabs */}
              <div className="bg-white border-b">
                <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                  <nav className="flex space-x-8">
                    {[
                      { id: 'overview', label: 'Overview', icon: Activity },
                      { id: 'query-analysis', label: 'SQL Analysis', icon: Code },
                      { id: 'issues', label: 'Issues', icon: AlertTriangle },
                      { id: 'recommendations', label: 'Recommendations', icon: Target },
                      { id: 'api-testing', label: 'API Testing', icon: Settings }
                    ].map(({ id, label, icon: Icon }) => (
                      <button
                        key={id}
                        onClick={() => setSelectedTab(id)}
                        className={`flex items-center space-x-2 py-4 border-b-2 ${
                          selectedTab === id 
                            ? 'border-blue-500 text-blue-600' 
                            : 'border-transparent text-gray-500 hover:text-gray-700'
                        }`}
                      >
                        <Icon className="w-4 h-4" />
                        <span>{label}</span>
                      </button>
                    ))}
                  </nav>
                </div>
              </div>

              <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                {renderTabContent()}
              </div>

              {/* Footer */}
              <div className="bg-white border-t mt-12">
                <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                  <div className="flex items-center justify-between text-sm text-gray-600">
                    <span>Enhanced with Looker MCP Server & API Testing</span>
                    <span>Built for Looker Hackathon 2025</span>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<LookerHealthDashboard />);
    </script>
</body>
</html>